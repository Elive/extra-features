#!/bin/bash
source /usr/lib/elive-tools/functions
el_make_environment
. gettext.sh
TEXTDOMAIN="elive-extra-features"
export TEXTDOMAIN


main(){
    # pre {{{
    local select

    guitool="/usr/bin/zenity --window-icon=/usr/share/icons/Elive/scalable/apps/logo-elive.png"


    # }}}

    if $guitool --question --text="$( eval_gettext "You are going to install the Microsoft Silverlight plugin for your browser which some few websites requires it, continue?" )" ; then

        # cleanups
        rm -rf "$HOME/.wine-pipelight"

        $guitool --info --text="$( eval_gettext "This plugin only works with the Iceweasel browser, also called Firefox, do not try to use it with another browser like Chrome." )"

        if gksu elive-extra-silverlight ; then
            # launch iceweasel to complete install
            #pipelight-plugin --accept --enable silverlight

            $guitool --info --text="$( eval_gettext "Now I'm going to launch Iceweasel to complete the installation." )"

            iceweasel about:plugins &
            sleep 40

            while [[ -n "$( ps ux | grep -v grep | grep "opt/wine-staging" )" ]] ; do sleep 2 ; done
            sleep 4
            while [[ -n "$( ps ux | grep -v grep | grep "opt/wine-staging" )" ]] ; do sleep 2 ; done

            killall iceweasel

            gksu "pipelight-plugin --accept --create-mozilla-plugins"
            iceweasel about:plugins &
            sleep 6


            # activate netflix too
            if $guitool --question --text="$( eval_gettext "Do you want to enable special support for Netflix?" )" ; then
                $guitool --info --text="$( eval_gettext "Seems like Netflix doesn't like Linux, so to make it accept your connection you need to fake your identity, making it think that you are not in Linux but in Windows instead. We can do this with a simple addon for Firefox." )"

                $guitool --info --text="$( eval_gettext "After to install the addon, select a Windows alternative from the top-right bar plugin selector. Like Firefox under Windows." )"

                iceweasel "http://www.google.com/search?q=%22user+agent+overrider%22+firefox+addon"
            fi


            wait
            sleep 20

            el_request_donation
        else
            $guitool --error --text="$( eval_gettext "There was a problem installing Silverlight, we are unable to complete it." )"
        fi
    fi


}

#
#  MAIN
#
main "$@"

# vim: set foldmethod=marker :
