#!/bin/bash
source /usr/lib/elive-tools/functions
el_make_environment
. gettext.sh
TEXTDOMAIN="elive-extra-features"
export TEXTDOMAIN


main(){
    # pre {{{
    local select

    guitool="/usr/bin/zenity --window-icon=/usr/share/icons/Elive/scalable/apps/logo-elive.png"


    # }}}

    if $guitool --question --text="$( eval_gettext "You are going to install the Microsoft Silverlight plugin for your browser which some few websites requires it, continue?" )" ; then

        # cleanups
        rm -rf "$HOME/.wine-pipelight"

        $guitool --info --text="$( eval_gettext "This plugin only works with the Iceweasel browser, also called Firefox, do not try to use it with another browser like Chrome." )"

        if gksu elive-extra-silverlight ; then
            # launch iceweasel to complete install
            pipelight-plugin --accept --enable silverlight

            $guitool --info --text="$( eval_gettext "Now I'm going to launch Iceweasel to complete the installation." )"

            #iceweasel about:plugins
            iceweasel &
            sleep 10

            while [[ -n "$( ps ux | grep -v grep | grep "opt/wine-staging" )" ]] ; do sleep 2 ; done
            sleep 4
            while [[ -n "$( ps ux | grep -v grep | grep "opt/wine-staging" )" ]] ; do sleep 2 ; done

            killall iceweasel

            gksu "pipelight-plugin --accept --create-mozilla-plugins"
            iceweasel about:plugins &
            sleep 4


            sleep 30

            el_request_donation
        else
            $guitool --error --text="$( eval_gettext "There was a problem installing Silverlight, we are unable to complete it." )"
        fi
    fi


}

#
#  MAIN
#
main "$@"

# vim: set foldmethod=marker :
